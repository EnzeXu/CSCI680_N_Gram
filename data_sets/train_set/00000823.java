public class ClipDataCompat { private static Method getClipDataFromIntent; private static Class persistableBundle; private static Method putBoolean; private static Method setExtras; private static boolean initSucceded; static { try { getClipDataFromIntent = Intent.class.getMethod("getClipData", (Class[])null); persistableBundle = Class.forName("android.os.PersistableBundle"); putBoolean = persistableBundle.getMethod("putBoolean", new Class[] {String.class, boolean.class}); setExtras = ClipDescription.class.getMethod("setExtras", new Class[]{persistableBundle}); initSucceded = true; } catch (Exception e) { initSucceded = false; } } public static Uri getUriFromIntent(Intent i, String key) { boolean clipDataSucceeded = false; if (initSucceded) { try { ClipData clip = (ClipData) getClipDataFromIntent.invoke(i, null); if (clip != null) { ClipDescription clipDescription = clip.getDescription(); CharSequence label = clipDescription.getLabel(); if (label.equals(key)) { int itemCount = clip.getItemCount(); if (itemCount == 1) { ClipData.Item clipItem = clip.getItemAt(0); if (clipItem != null) { return clipItem.getUri(); } } } } return null; } catch (Exception e) { } } return i.getParcelableExtra(key); } public static void markSensitive(ClipData clipData) { try { Object extras = persistableBundle.newInstance(); putBoolean.invoke(extras, "android.content.extra.IS_SENSITIVE", true); setExtras.invoke(clipData.getDescription(), extras); } catch (Exception e) { } } }