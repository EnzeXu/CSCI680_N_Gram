public class AddEntry extends RunnableOnFinish { protected Database mDb; private PwEntry mEntry; private Context ctx; public static AddEntry getInstance(Context ctx, Database db, PwEntry entry, OnFinish finish) { return new AddEntry(ctx, db, entry, finish); } protected AddEntry(Context ctx, Database db, PwEntry entry, OnFinish finish) { super(finish); mDb = db; mEntry = entry; this.ctx = ctx; mFinish = new AfterAdd(mFinish); } @Override public void run() { mDb.pm.addEntryTo(mEntry, mEntry.getParent()); SaveDB save = new SaveDB(ctx, mDb, mFinish); save.run(); } private class AfterAdd extends OnFinish { public AfterAdd(OnFinish finish) { super(finish); } @Override public void run() { PwDatabase pm = mDb.pm; if ( mSuccess ) { PwGroup parent = mEntry.getParent(); mDb.dirty.add(parent); } else { pm.removeEntryFrom(mEntry, mEntry.getParent()); } super.run(); } } }