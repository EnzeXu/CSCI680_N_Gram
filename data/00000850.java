public class TimeoutHelper { private static final long DEFAULT_TIMEOUT = 5 * 60 * 1000 ; public static void pause ( Activity act ) { long time = System . currentTimeMillis ( ) ; SharedPreferences prefs = PreferenceManager . getDefaultSharedPreferences ( act ) ; SharedPreferences . Editor edit = prefs . edit ( ) ; edit . putLong ( act . getString ( R . string . timeout_key ) , time ) ; edit . apply ( ) ; if ( App . getDB ( ) . Loaded ( ) ) { Timeout . start ( act ) ; } } public static long getTimeoutLength ( Context ctx ) { SharedPreferences prefs = PreferenceManager . getDefaultSharedPreferences ( ctx ) ; String sTimeout = prefs . getString ( ctx . getString ( R . string . app_timeout_key ) , ctx . getString ( R . string . clipboard_timeout_default ) ) ; long timeout ; try { timeout = Long . parseLong ( sTimeout ) ; } catch ( NumberFormatException e ) { timeout = DEFAULT_TIMEOUT ; } return timeout ; } public static void resume ( Activity act ) { if ( App . getDB ( ) . Loaded ( ) ) { Timeout . cancel ( act ) ; } long cur_time = System . currentTimeMillis ( ) ; SharedPreferences prefs = PreferenceManager . getDefaultSharedPreferences ( act ) ; long timeout_start = prefs . getLong ( act . getString ( R . string . timeout_key ) , -1 ) ; if ( timeout_start == -1 ) { return ; } long timeout = getTimeoutLength ( act ) ; if ( timeout == -1 ) { return ; } long diff = cur_time - timeout_start ; if ( diff > = timeout ) { App . setShutdown ( ) ; } } public static void checkShutdown ( Activity act ) { if ( App . isShutdown ( ) && App . getDB ( ) . Loaded ( ) ) { act . setResult ( KeePass . EXIT_LOCK ) ; act . finish ( ) ; } } }