public class KetamaConnectionFactory extends DefaultConnectionFactory { private final KetamaNodeKeyFormatter . Format ketamaNodeKeyFormat ; private Map < InetSocketAddress , Integer > weights ; public KetamaConnectionFactory ( int qLen , int bufSize , long opQueueMaxBlockTime ) { this ( qLen , bufSize , opQueueMaxBlockTime , DefaultHashAlgorithm . KETAMA_HASH , KetamaNodeKeyFormatter . Format . SPYMEMCACHED , new HashMap < InetSocketAddress , Integer > ( ) ) ; } public KetamaConnectionFactory ( int qLen , int bufSize , long opQueueMaxBlockTime , HashAlgorithm hash , KetamaNodeKeyFormatter . Format nodeKeyFormat , Map < InetSocketAddress , Integer > weights ) { super ( qLen , bufSize , hash ) ; this . ketamaNodeKeyFormat = nodeKeyFormat ; this . weights = weights ; } public KetamaConnectionFactory ( ) { this ( DEFAULT_OP_QUEUE_LEN , DEFAULT_READ_BUFFER_SIZE , DEFAULT_OP_QUEUE_MAX_BLOCK_TIME ) ; } @ Override public NodeLocator createLocator ( List < MemcachedNode > nodes ) { return new KetamaNodeLocator ( nodes , getHashAlg ( ) , getKetamaNodeKeyFormat ( ) , getWeights ( ) ) ; } public KetamaNodeKeyFormatter . Format getKetamaNodeKeyFormat ( ) { return ketamaNodeKeyFormat ; } public Map < InetSocketAddress , Integer > getWeights ( ) { return weights ; } }