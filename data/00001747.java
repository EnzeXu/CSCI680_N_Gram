public class JSONNestedPlatformTest extends PlatformTestCase { public JSONNestedPlatformTest ( ) { } @ Test public void testSimpleGroup ( ) throws Exception { getPlatform ( ) . copyFromLocal ( inputFileJSON ) ; Tap source = getPlatform ( ) . getJSONFile ( new Fields ( "json" ) , inputFileJSON ) ; Pipe pipe = new Pipe ( "test" ) ; CopySpec copySpec = new CopySpec ( ) . include ( "/_id/$oid" , "/borrower" , "/project_name" , "/approvalfy" ) . transform ( "/approvalfy" , JSONPrimitiveTransforms . TO_STRING ) ; pipe = new Each ( pipe , new Fields ( "json" ) , new JSONCopyAsFunction ( new Fields ( "result" ) , copySpec ) , Fields . RESULTS ) ; pipe = new Each ( pipe , new Fields ( "result" ) , new JSONGetFunction ( new Fields ( "year" , int . class ) , "/approvalfy" ) , Fields . ALL ) ; pipe = new GroupBy ( pipe , new Fields ( "year" ) ) ; Tap sink = getPlatform ( ) . getJSONFile ( new Fields ( "result" ) , getOutputPath ( ) , SinkMode . REPLACE ) ; Flow flow = getPlatform ( ) . getFlowConnector ( ) . connect ( source , sink , pipe ) ; flow . complete ( ) ; validateLength ( flow , 20 ) ; List < Tuple > results = asList ( flow , sink ) ; assertEquals ( 20 , results . size ( ) ) ; boolean allMatch = results . stream ( ) . map ( tuple - > tuple . getObject ( 0 ) ) . allMatch ( node - > node instanceof JsonNode ) ; assertTrue ( allMatch ) ; } }