public class KeyStatsOperationImpl extends SingleKeyOperationImpl implements StatsOperation { private static final byte CMD = 0x10 ; public KeyStatsOperationImpl ( String key , StatsOperation . Callback c ) { super ( CMD , generateOpaque ( ) , key , c ) ; } @ Override public void initialize ( ) { String keyval = "key " + key + " " + getVBucket ( key ) ; prepareBuffer ( keyval , 0 , EMPTY_BYTES ) ; } @ Override protected void finishedPayload ( byte [ ] pl ) throws IOException { if ( keyLen > 0 ) { final byte [ ] keyBytes = new byte [ keyLen ] ; final byte [ ] data = new byte [ pl . length - keyLen ] ; System . arraycopy ( pl , 0 , keyBytes , 0 , keyLen ) ; System . arraycopy ( pl , keyLen , data , 0 , pl . length - keyLen ) ; Callback cb = ( Callback ) getCallback ( ) ; cb . gotStat ( new String ( keyBytes , "UTF-8" ) , new String ( data , "UTF-8" ) ) ; } else { OperationStatus status = getStatusForErrorCode ( errorCode , pl ) ; getCallback ( ) . receivedStatus ( status ) ; transitionState ( OperationState . COMPLETE ) ; } resetInput ( ) ; } }