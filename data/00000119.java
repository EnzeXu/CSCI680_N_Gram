public class ReplicaGetOperationImpl extends SingleKeyOperationImpl implements ReplicaGetOperation { static final byte REPLICA_GET_CMD = (byte)0x83; private final int replicaIndex; static final int EXTRA_HDR_LEN = 4; public ReplicaGetOperationImpl(String k, int index, ReplicaGetOperation.Callback cb) { super(REPLICA_GET_CMD, generateOpaque(), k, cb); replicaIndex = index; } @Override public void initialize() { prepareBuffer(key, 0, EMPTY_BYTES); } @Override protected void decodePayload(byte[] pl) { final int flags = decodeInt(pl, 0); final byte[] data = new byte[pl.length - EXTRA_HDR_LEN - keyLen]; System.arraycopy(pl, (EXTRA_HDR_LEN + keyLen), data, 0, pl.length - EXTRA_HDR_LEN - keyLen); ReplicaGetOperation.Callback gcb = (ReplicaGetOperation.Callback) getCallback(); gcb.gotData(key, flags, data); getCallback().receivedStatus(STATUS_OK); } public int getReplicaIndex() { return replicaIndex; } }