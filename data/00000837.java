public class MacOutputStream extends OutputStream { private Mac mac ; private OutputStream os ; public MacOutputStream ( OutputStream os , Mac mac ) { this . mac = mac ; this . os = os ; } @ Override public void flush ( ) throws IOException { os . flush ( ) ; } @ Override public void close ( ) throws IOException { os . close ( ) ; } @ Override public void write ( int oneByte ) throws IOException { mac . update ( ( byte ) oneByte ) ; os . write ( oneByte ) ; } @ Override public void write ( byte [ ] buffer , int offset , int count ) throws IOException { mac . update ( buffer , offset , count ) ; os . write ( buffer , offset , count ) ; } @ Override public void write ( byte [ ] buffer ) throws IOException { mac . update ( buffer , 0 , buffer . length ) ; os . write ( buffer ) ; } public byte [ ] getMac ( ) { return mac . doFinal ( ) ; } }