public class TapFileOutputStream extends FileOutputStream { public TapFileOutputStream( String path, boolean append ) throws FileNotFoundException { super( prepare( null, path ), append ); } public TapFileOutputStream( Tap parent, String path, boolean update ) throws FileNotFoundException { super( prepare( parent, path ), update ); } private static String prepare( Tap parent, String path ) { File file; if( parent == null || path.startsWith( parent.getIdentifier() ) ) file = new File( path ); else file = new File( parent.getIdentifier(), path ); File parentFile = file.getAbsoluteFile().getParentFile(); if( parentFile != null && parentFile.exists() && parentFile.isFile() ) throw new TapException( "cannot create parent directory, it already exists as a file: " + parentFile.getAbsolutePath() ); if( parentFile != null ) parentFile.mkdirs(); return file.getAbsolutePath(); } }