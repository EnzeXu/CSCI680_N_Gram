public class BuildAssertionsPlatformTest extends PlatformTestCase { public BuildAssertionsPlatformTest ( ) { } @ Test public void testLoneGroupAssertion ( ) throws Exception { Tap source = getPlatform ( ) . getTextFile ( "input" ) ; Tap sink = getPlatform ( ) . getTextFile ( "output" , SinkMode . REPLACE ) ; Pipe pipe = new Pipe ( "test" ) ; String regex = TestConstants . APACHE_COMMON_REGEX ; pipe = new Each ( pipe , new Fields ( "line" ) , new RegexParser ( new Fields ( "ip" , "time" , "method" , "event" , "status" , "size" ) , regex , new int [ ] { 1 , 2 , 3 , 4 , 5 , 6 } ) ) ; pipe = new Each ( pipe , AssertionLevel . STRICT , new AssertNotNull ( ) ) ; pipe = new Each ( pipe , new Fields ( "method" ) , new RegexFilter ( "^POST" ) ) ; pipe = new Each ( pipe , new Fields ( "method" ) , AssertionLevel . STRICT , new AssertMatches ( "^POST" ) ) ; pipe = new GroupBy ( pipe , new Fields ( "method" ) ) ; pipe = new Every ( pipe , AssertionLevel . STRICT , new AssertGroupSizeEquals ( 7L ) ) ; try { Flow flow = getPlatform ( ) . getFlowConnector ( ) . connect ( source , sink , pipe ) ; fail ( "did not throw lone group assertion error" ) ; } catch ( Exception exception ) { } } }