public class AppSettingsFragement extends PreferenceFragmentCompat { public static boolean KEYFILE_DEFAULT = false; private BackupManager backupManager; public static void Launch(Context ctx) { Intent i = new Intent(ctx, AppSettingsFragement.class); ctx.startActivity(i); } @Override public void onCreate(@Nullable Bundle savedInstanceState) { super.onCreate(savedInstanceState); setRetainInstance(true); } @Override public void onCreatePreferences(Bundle savedInstanceState, String rootKey) { addPreferencesFromResource(R.xml.preferences_app); Preference keyFile = findPreference(getString(R.string.keyfile_key)); keyFile.setOnPreferenceChangeListener(new Preference.OnPreferenceChangeListener() { public boolean onPreferenceChange(Preference preference, Object newValue) { Boolean value = (Boolean) newValue; if ( ! value.booleanValue() ) { App.getFileHistory().deleteAllKeys(); } return true; } }); Preference recentHistory = findPreference(getString(R.string.recentfile_key)); recentHistory.setOnPreferenceChangeListener(new Preference.OnPreferenceChangeListener() { public boolean onPreferenceChange(Preference preference, Object newValue) { Boolean value = (Boolean) newValue; if (value == null) { value = true; } if (!value) { App.getFileHistory().deleteAll(); } return true; } }); backupManager = new BackupManager(getContext()); } @Override public void onStop() { backupManager.dataChanged(); super.onStop(); } }